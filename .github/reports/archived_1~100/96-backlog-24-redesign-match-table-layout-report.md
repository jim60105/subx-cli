---
title: "Job Report: Backlog #24 - 重新設計 Match 表格版面配置"
date: "2025-06-11T12:45:10Z"
---

# Backlog #24 - 重新設計 Match 表格版面配置 工作報告

**日期**：2025-06-11T12:45:10Z  
**任務**：重新設計 match 命令表格版面配置，採用垂直資訊組織方式  
**類型**：Backlog  
**狀態**：已完成

## 一、任務概述

目前的 match 命令採用四欄位水平排列（狀態、影片檔案、字幕檔案、新檔名），導致終端輸出過寬、長路徑截斷與資訊密度過高等可讀性問題。

本次任務目標：

- 垂直資訊佈局：每個匹配結果使用多行顯示（影片、字幕、新檔名）
- 簡化欄位結構：改為兩欄位（狀態 + 檔案名稱）
- 完整路徑顯示：確保檔案路徑不被截斷
- 清晰視覺指示：狀態圖示僅首行顯示，其餘行使用連接符號

## 二、實作內容

### 2.1 重構 MatchDisplayRow 結構

- 將原四個水平欄位（status、video_file、subtitle_file、new_name）簡化為兩個欄位：`status`、`filename`
- 更新欄位標籤為中文「狀態」與「檔案名稱」
- 變更檔案：【F:src/cli/table.rs†L94-L104】

### 2.2 實作多行顯示邏輯

- 在 `display_match_results` 中，將每個 `MatchOperation` 拆分為三行：影片、字幕與新檔名
- 狀態圖示僅在首行顯示，後續行空白，並使用 `├`、`└` 作為連接符號
- 變更檔案：【F:src/cli/ui.rs†L295-L319】

### 2.3 更新單元測試

- 調整 `test_match_table_display` 測試案例，以驗證多行格式是否正確顯示
- 變更檔案：【F:src/cli/ui.rs†L333-L353】

### 2.4 更新文件註解與範例

- 修正 `src/cli/table.rs` 的 doc comment 範例，展示多行用法
- 變更檔案：【F:src/cli/table.rs†L22-L43】【F:src/cli/table.rs†L73-L93】【F:src/cli/table.rs†L130-L146】

## 三、技術細節

- 僅修改 CLI 輸出格式，無 API 破壞性變更
- 無額外依賴或配置變更

## 四、測試與驗證

### 4.1 程式碼品質檢查
```bash
cargo fmt -- --check
cargo clippy -- -D warnings
cargo test
```

### 4.2 功能驗證

- 執行 `subx match` （dry-run 與實際模式）確認輸出符合多行版面需求
- 確認長路徑完整顯示，狀態圖示與連接符號對齊

## 五、影響評估

- 向後相容性：CLI 輸出格式變更，建議提供格式切換選項以支援舊版使用者

## 六、後續事項

- 可考慮新增 CLI 參數切換舊/新表格格式

## 八、檔案異動清單

| 檔案路徑              | 異動類型 | 描述                             |
|-----------------------|----------|----------------------------------|
| src/cli/table.rs      | 修改     | 重構欄位結構、更新 doc 範例       |
| src/cli/ui.rs         | 修改     | 實作多行顯示邏輯、更新測試案例   |
