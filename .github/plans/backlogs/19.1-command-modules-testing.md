# Product Backlog #19.1: æŒ‡ä»¤æ¨¡çµ„æ¸¬è©¦å®Œå–„

## é ˜åŸŸç¯„åœ
é‡å°æŒ‡ä»¤æ¨¡çµ„ (commands/) å»ºç«‹å®Œæ•´æ¸¬è©¦è¦†è“‹ï¼Œè§£æ±ºç•¶å‰é›¶è¦†è“‹ç‡å•é¡Œï¼Œå¯¦ç¾ 60-70% ç›®æ¨™è¦†è“‹ç‡

## èƒŒæ™¯è„ˆçµ¡

ç•¶å‰æŒ‡ä»¤æ¨¡çµ„è™•æ–¼é›¶æ¸¬è©¦è¦†è“‹ç‹€æ…‹ï¼Œé€™æ˜¯å½±éŸ¿æ•´é«”è¦†è“‹ç‡çš„é—œéµå› ç´ ã€‚æœ¬ backlog å°ˆæ³¨æ–¼ï¼š
- cache_command.rs (0% â†’ 60%)
- config_command.rs (0% â†’ 60%) 
- detect_encoding_command.rs (0% â†’ 60%)
- sync_command.rs (0% â†’ 60%)

## å®Œæˆé …ç›®

### ğŸ”¥ ç¬¬ä¸€éšæ®µï¼šåŸºç¤æŒ‡ä»¤æ¸¬è©¦ (2-3 å¤©)

#### 1.1 cache_command.rs æ¸¬è©¦å¯¦ä½œ
**ç›®æ¨™è¦†è“‹ç‡**: 0% â†’ 60%

- [ ] **å¿«å–æ¸…ç†åŠŸèƒ½æ¸¬è©¦ (`clear_cache`)**
  ```rust
  #[tokio::test]
  async fn test_clear_cache_success() {
      // å»ºç«‹æ¸¬è©¦å¿«å–æª”æ¡ˆ
      let temp_dir = TempDir::new().unwrap();
      let cache_path = temp_dir.path().join("cache");
      
      // æ¸¬è©¦å¿«å–æ¸…ç†
      let result = clear_cache(&cache_path).await;
      assert!(result.is_ok());
      assert!(!cache_path.exists());
  }
  ```

- [ ] **å¿«å–çµ±è¨ˆé¡¯ç¤ºæ¸¬è©¦ (`show_stats`)**
  ```rust
  #[tokio::test]
  async fn test_show_cache_stats() {
      let temp_dir = TempDir::new().unwrap();
      create_test_cache_files(&temp_dir).await;
      
      let stats = show_cache_stats(&temp_dir.path()).await.unwrap();
      assert_eq!(stats.file_count, 3);
      assert!(stats.total_size > 0);
  }
  ```

- [ ] **å¿«å–æª”æ¡ˆç®¡ç†æ¸¬è©¦ (`manage_files`)**
- [ ] **éŒ¯èª¤è™•ç†é‚Šç•Œæ¸¬è©¦** (æ¬Šé™ã€æª”æ¡ˆä¸å­˜åœ¨)
- [ ] **æ¨¡æ“¬æª”æ¡ˆç³»çµ±æ¸¬è©¦ç’°å¢ƒ**

#### 1.2 config_command.rs æ¸¬è©¦å¯¦ä½œ  
**ç›®æ¨™è¦†è“‹ç‡**: 0% â†’ 60%

- [ ] **é…ç½®é¡¯ç¤ºåŠŸèƒ½æ¸¬è©¦ (`show_config`)**
  ```rust
  #[tokio::test]
  async fn test_show_config_display() {
      let config = create_test_config();
      let output = show_config(&config).await.unwrap();
      
      assert!(output.contains("ai.provider"));
      assert!(output.contains("openai"));
  }
  ```

- [ ] **é…ç½®è¨­å®šåŠŸèƒ½æ¸¬è©¦ (`set_config`)**
  ```rust
  #[tokio::test]
  async fn test_set_config_value() {
      let mut config = Config::default();
      
      set_config_value(&mut config, "ai.model", "gpt-4").await.unwrap();
      assert_eq!(config.ai.model, "gpt-4");
  }
  ```

- [ ] **é…ç½®é©—è­‰åŠŸèƒ½æ¸¬è©¦ (`validate_config`)**
- [ ] **é…ç½®é‡ç½®åŠŸèƒ½æ¸¬è©¦ (`reset_config`)**
- [ ] **ç„¡æ•ˆé…ç½®è™•ç†æ¸¬è©¦**

#### 1.3 detect_encoding_command.rs æ¸¬è©¦å¯¦ä½œ
**ç›®æ¨™è¦†è“‹ç‡**: 0% â†’ 60%

- [ ] **å–®æª”æ¡ˆç·¨ç¢¼æª¢æ¸¬æ¸¬è©¦**
  ```rust
  #[tokio::test]
  async fn test_detect_single_file_encoding() {
      let temp_dir = TempDir::new().unwrap();
      let utf8_file = create_utf8_subtitle_file(&temp_dir).await;
      
      let result = detect_file_encoding(&utf8_file).await.unwrap();
      assert_eq!(result.encoding, Charset::Utf8);
      assert!(result.confidence > 0.9);
  }
  ```

- [ ] **æ‰¹é‡ç·¨ç¢¼æª¢æ¸¬æ¸¬è©¦**
  ```rust
  #[tokio::test]
  async fn test_batch_encoding_detection() {
      let temp_dir = TempDir::new().unwrap();
      let files = create_mixed_encoding_files(&temp_dir).await;
      
      let results = detect_batch_encoding(&files).await.unwrap();
      assert_eq!(results.len(), files.len());
      
      // é©—è­‰ä¸åŒç·¨ç¢¼æª¢æ¸¬çµæœ
      assert!(results.iter().any(|r| r.encoding == Charset::Utf8));
      assert!(results.iter().any(|r| r.encoding == Charset::Gbk));
  }
  ```

- [ ] **ç·¨ç¢¼è½‰æ›å»ºè­°æ¸¬è©¦**
- [ ] **ä¸æ”¯æ´æ ¼å¼è™•ç†æ¸¬è©¦**
- [ ] **æª”æ¡ˆè®€å–éŒ¯èª¤è™•ç†æ¸¬è©¦**

#### 1.4 sync_command.rs æ¸¬è©¦å¯¦ä½œ
**ç›®æ¨™è¦†è“‹ç‡**: 0% â†’ 60%

- [ ] **éŸ³è¨ŠåŒæ­¥æµç¨‹æ¸¬è©¦**
  ```rust
  #[tokio::test]
  async fn test_audio_sync_workflow() {
      let temp_dir = TempDir::new().unwrap();
      let audio_file = create_test_audio_file(&temp_dir).await;
      let subtitle_file = create_test_subtitle_file(&temp_dir).await;
      
      let result = sync_audio_subtitle(&audio_file, &subtitle_file, SyncConfig::default()).await;
      assert!(result.is_ok());
      
      let sync_result = result.unwrap();
      assert!(sync_result.confidence > 0.7);
      assert!(!sync_result.adjustments.is_empty());
  }
  ```

- [ ] **åŒæ­¥åƒæ•¸é©—è­‰æ¸¬è©¦**
- [ ] **åŒæ­¥çµæœè¼¸å‡ºæ¸¬è©¦**
- [ ] **ä¸åŒ¹é…æª”æ¡ˆè™•ç†æ¸¬è©¦**
- [ ] **åŒæ­¥å¤±æ•—æ¢å¾©æ¸¬è©¦**

### ğŸ› ï¸ ç¬¬äºŒéšæ®µï¼šCLI åƒæ•¸æ¨¡çµ„è£œé½Š (1-2 å¤©)

#### 2.1 config_args.rs æ¸¬è©¦å¯¦ä½œ
**ç›®æ¨™è¦†è“‹ç‡**: 30% â†’ 70%

- [ ] **é…ç½®è·¯å¾‘åƒæ•¸é©—è­‰**
  ```rust
  #[test]
  fn test_config_path_validation() {
      let args = ConfigArgs {
          config_path: Some("/invalid/path".into()),
          ..Default::default()
      };
      
      let result = args.validate();
      assert!(result.is_err());
      assert!(result.unwrap_err().to_string().contains("é…ç½®æª”æ¡ˆä¸å­˜åœ¨"));
  }
  ```

- [ ] **è¨­å®šå€¼æ ¼å¼é©—è­‰**
- [ ] **ç„¡æ•ˆåƒæ•¸éŒ¯èª¤è™•ç†**
- [ ] **å¤šå€‹é…ç½®é¸é …çµ„åˆæ¸¬è©¦**

#### 2.2 detect_encoding_args.rs æ¸¬è©¦å¯¦ä½œ
**ç›®æ¨™è¦†è“‹ç‡**: 0% â†’ 70%

- [ ] **ç·¨ç¢¼æª¢æ¸¬åƒæ•¸é©—è­‰**
- [ ] **è¼¸å‡ºæ ¼å¼é¸é …æ¸¬è©¦**  
- [ ] **æ‰¹é‡è™•ç†æ¨™èªŒæ¸¬è©¦**
- [ ] **åƒæ•¸è¡çªæª¢æ¸¬æ¸¬è©¦**

### ğŸ¯ ç¬¬ä¸‰éšæ®µï¼šUI æ¨¡çµ„è¦†è“‹ç‡æå‡ (1 å¤©)

#### 3.1 ui.rs æ¸¬è©¦æ“´å……
**ç›®æ¨™è¦†è“‹ç‡**: 31.75% â†’ 50%

- [ ] **è¡¨æ ¼è¼¸å‡ºæ ¼å¼æ¸¬è©¦**
  ```rust
  #[test]
  fn test_table_formatting() {
      let data = vec![
          ("æª”æ¡ˆ", "ç·¨ç¢¼", "ä¿¡å¿ƒå€¼"),
          ("test.srt", "UTF-8", "0.95"),
      ];
      
      let table = format_table(&data);
      assert!(table.contains("UTF-8"));
      assert!(table.contains("0.95"));
  }
  ```

- [ ] **é€²åº¦æ¢é¡¯ç¤ºé‚è¼¯æ¸¬è©¦**
- [ ] **éŒ¯èª¤è¨Šæ¯æ ¼å¼åŒ–æ¸¬è©¦**
- [ ] **é¡è‰²è¼¸å‡ºåŠŸèƒ½æ¸¬è©¦**
- [ ] **çµ‚ç«¯å¯¬åº¦é©æ‡‰æ¸¬è©¦**

## ğŸ“Š å¯¦ä½œæŒ‡å—

### æ¸¬è©¦æª”æ¡ˆçµæ§‹
```
tests/
â”œâ”€â”€ commands/
â”‚   â”œâ”€â”€ cache_command_tests.rs      # å¿«å–æŒ‡ä»¤æ¸¬è©¦
â”‚   â”œâ”€â”€ config_command_tests.rs     # é…ç½®æŒ‡ä»¤æ¸¬è©¦  
â”‚   â”œâ”€â”€ detect_encoding_tests.rs    # ç·¨ç¢¼æª¢æ¸¬æ¸¬è©¦
â”‚   â””â”€â”€ sync_command_tests.rs       # åŒæ­¥æŒ‡ä»¤æ¸¬è©¦
â””â”€â”€ cli/
    â”œâ”€â”€ config_args_tests.rs        # é…ç½®åƒæ•¸æ¸¬è©¦
    â”œâ”€â”€ detect_encoding_args_tests.rs # ç·¨ç¢¼åƒæ•¸æ¸¬è©¦
    â””â”€â”€ ui_tests.rs                  # UI æ¨¡çµ„æ¸¬è©¦
```

### æ¸¬è©¦è¼”åŠ©å·¥å…·
```rust
// tests/common/command_helpers.rs
pub async fn create_test_config() -> Config {
    Config {
        ai: AIConfig {
            provider: AIProvider::OpenAI,
            model: "gpt-4".to_string(),
            api_key: "test-key".to_string(),
        },
        // ... å…¶ä»–é…ç½®
    }
}

pub async fn create_test_cache_files(dir: &TempDir) -> Vec<PathBuf> {
    let files = vec!["cache1.json", "cache2.json", "cache3.json"];
    let mut paths = Vec::new();
    
    for file in files {
        let path = dir.path().join(file);
        fs::write(&path, "test data").await.unwrap();
        paths.push(path);
    }
    
    paths
}
```

## ğŸ“ˆ é æœŸæˆæœ

### è¦†è“‹ç‡ç›®æ¨™
- **cache_command.rs**: 0% â†’ 60%
- **config_command.rs**: 0% â†’ 60%  
- **detect_encoding_command.rs**: 0% â†’ 60%
- **sync_command.rs**: 0% â†’ 60%
- **CLI åƒæ•¸æ¨¡çµ„**: å¹³å‡æå‡åˆ° 70%

### æ¸¬è©¦æ•¸é‡
- **æ–°å¢æ¸¬è©¦**: ~40 å€‹
- **æ¸¬è©¦æª”æ¡ˆ**: ~8 å€‹
- **é è¨ˆåŸ·è¡Œæ™‚é–“**: +5-8 ç§’

## ğŸ¯ æˆåŠŸæ¨™æº–

1. **æ‰€æœ‰æŒ‡ä»¤æ¨¡çµ„é”åˆ° 60% è¦†è“‹ç‡**
2. **CLI åƒæ•¸æ¨¡çµ„é”åˆ° 70% è¦†è“‹ç‡**  
3. **æ‰€æœ‰æ¸¬è©¦ç©©å®šé€šé**
4. **æ¸¬è©¦åŸ·è¡Œæ™‚é–“ <30 ç§’**

---

**å»ºç«‹æ—¥æœŸ**: 2025-06-09  
**é æœŸå®Œæˆ**: 2025-06-12 (3 å¤©)  
**å‰ç½®æ¢ä»¶**: åŸºç¤æ¸¬è©¦ç’°å¢ƒè¨­å®šå®Œæˆ  
**å¾ŒçºŒå·¥ä½œ**: [#19.2 éŸ³è¨Šèˆ‡ç·¨ç¢¼æ¸¬è©¦](19.2-audio-encoding-testing.md)
