# Backlog 33: 完成 Sync 架構驗證與修復

## 概覽

基於 [程式碼審查報告 #138](../reports/138-backlog-32-sync-architecture-redesign-code-review.md) 的發現，Backlog #32 的核心架構已完成 75-80%，但仍有關鍵問題需要修復以確保功能完整性。

本 backlog 專注於修復已識別的問題，完成 #32 原始需求，不新增額外功能。

## 核心問題

根據程式碼審查，需要修復以下問題：

1. **測試問題**：大量整合測試標記為 `#[ignore]`，缺乏實際驗證
2. **回退機制未完全驗證**：Whisper-VAD 回退邏輯需要測試確認
3. **VAD 測試環境依賴**：需要不依賴外部檔案的基本測試
4. **基本文檔缺失**：缺乏使用者指南和配置範例

## 修復任務

### 任務 1：修復整合測試
**目標**：讓所有標記為 `#[ignore]` 的整合測試能夠正常執行

**具體工作**：
- 移除或修復 `tests/whisper_integration_tests.rs` 中的 `#[ignore]` 標記
- 移除或修復 `tests/vad_integration_tests.rs` 中的 `#[ignore]` 標記
- 為測試建立合成音訊檔案或模擬環境，避免依賴外部資源
- 確保測試在 CI 環境中可以穩定執行

**驗收標準**：
- `cargo test` 執行所有測試，無 ignore 警告
- 所有整合測試通過或有明確的跳過邏輯（如缺少 API 金鑰）

### 任務 2：驗證 Whisper-VAD 回退機制
**目標**：確認 Whisper API 失敗時能正確回退到 VAD

**具體工作**：
- 建立測試案例模擬 Whisper API 呼叫失敗
- 驗證 `fallback_to_vad = true` 配置的實際運作
- 測試低信心度場景的回退行為
- 驗證回退過程中的錯誤處理和日誌記錄

**驗收標準**：
- 有明確的回退測試案例並通過
- 回退機制在實際場景中運作正常

### 任務 3：建立基本 VAD 測試
**目標**：提供不依賴外部檔案的 VAD 功能驗證

**具體工作**：
- 建立合成音訊資料的 VAD 測試
- 實作基本的語音檢測精度驗證
- 確保 VAD 配置參數的基本功能測試

**驗收標準**：
- VAD 模組有基本的單元測試覆蓋
- 測試不依賴外部音訊檔案

### 任務 4：補充基本使用文檔
**目標**：提供使用者所需的基本配置和使用範例

**具體工作**：
- 在 `docs/configuration-guide.md` 中補充 sync 配置的完整範例
- 建立基本的使用案例說明
- 提供從舊配置遷移的基本指引

**驗收標準**：
- 使用者可以根據文檔成功配置和使用新的 sync 功能
- 文檔涵蓋基本的配置選項和使用方法

## 不包含的工作

為保持焦點，以下工作**不**在此 backlog 中：
- 新功能開發或架構變更
- 性能優化或進階配置選項
- 詳細的 API 文檔補充
- 複雜的測試基礎設施建設

## 驗收標準

1. **測試穩定性**：`cargo test` 無 `#[ignore]` 警告，所有測試通過
2. **功能驗證**：Whisper-VAD 回退機制經過測試驗證
3. **基本可用性**：VAD 功能有基本測試覆蓋
4. **使用者文檔**：基本配置和使用指南完整

## 風險評估

- **低風險**：主要為修復和驗證工作，不涉及架構變更
- **時間風險**：合成音訊檔案建立可能需要額外時間
- **依賴風險**：需要 OpenAI API 金鑰進行回退測試

## 預估工時

- **總工時**：8-12 小時
- **任務 1**：4-5 小時
- **任務 2**：2-3 小時  
- **任務 3**：2-3 小時
- **任務 4**：2-3 小時

---

**負責人**: 待指派  
**建立日期**: 2025-06-14  
**狀態**: 待開始  
**優先級**: 高  
**相關**: Backlog #32, 程式碼審查報告 #138
